INCLUDES =

all: $(DEFAULT_TARGETS) README.md report.html
.PHONY: all

README_SOURCES = $(wildcard *Script.sml) $(wildcard *Lib.sml) $(wildcard *Syntax.sml)
DIRS = $(wildcard */)
README.md: $(dprot $(CAKEMLDIR)/developers/readme_gen) readmePrefix $(patsubst %,%readmePrefix,$(DIRS)) $(README_SOURCES)
	$(protect $(CAKEMLDIR)/developers/readme_gen) $(README_SOURCES)

MLTON_PLOTS = plot1noerr.svg plot2noerr.svg plot3noerr.svg all.dat

#TODO: update cakeml_benchmarks
#report.html: benchmarks2.eps
#	echo '<!doctype html>' > report.html
#	echo '<html lang="en">' >> report.html
#	echo '<head><meta charset="utf-8">' >> report.html
#	echo '<title>CakeML benchmark report</title>' >> report.html
#	echo '</head>' >> report.html
#	echo '<body>' >> report.html
#	echo '<h1>CakeML benchmarks</h1>' >> report.html
#	echo '<img src="benchmarks2.eps">' >> report.html
#	echo '</body>' >> report.html
#	echo '</html>' >> report.html
#
#benchmarks2.eps:
#	cakeml_benchmarks/run_all.sh
#	$(CP) cakeml_benchmarks/benchmarks2.eps benchmarks2.eps

report.html: $(MLTON_PLOTS)
	echo '<!doctype html>' > report.html
	echo '<html lang="en">' >> report.html
	echo '<head><meta charset="utf-8">' >> report.html
	echo '<style>' >> report.html
	echo 'text {' >> report.html
	echo '	white-space: pre;' >> report.html
	echo '}' >> report.html
	echo '</style>' >> report.html
	echo '<title>CakeML benchmark report</title>' >> report.html
	echo '</head>' >> report.html
	echo '<body>' >> report.html
	echo '<h1>MLton benchmark plots</h1> <p>' >> report.html
	echo '<img src="plot1noerr.svg"> <p>' >> report.html
	echo '<img src="plot2noerr.svg"> <p>' >> report.html
	echo '<img src="plot3noerr.svg"> <p>' >> report.html
	echo '<h1>MLton benchmark raw numbers (mean & std. dev., in seconds)</h1> <p>' >> report.html
	echo '<text>' >> report.html
	cat  all.dat >> report.html
	echo '</text>' >> report.html
	echo '</body>' >> report.html
	echo '</html>' >> report.html

$(MLTON_PLOTS): mlton_benchmarks/benchmark.py
	cd mlton_benchmarks; python benchmark.py
	$(CP) mlton_benchmarks/*.svg .
	$(CP) mlton_benchmarks/all.dat .

